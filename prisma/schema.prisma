// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider   = "prisma-client-js"
  engineType = "client"
}

datasource db {
  provider = "postgresql"
}

model Etf {
  ticker         String          @id
  name           String
  currency       String
  exchange       String?
  price          Decimal
  daily_change   Decimal
  yield          Decimal?
  mer            Decimal?
  assetType      String          @default("ETF")
  isDeepAnalysisLoaded Boolean   @default(false)
  history        EtfHistory[]
  sectors        EtfSector[]
  allocation     EtfAllocation?
  portfolioItem  PortfolioItem?

  updatedAt      DateTime        @updatedAt
}

model EtfHistory {
  id        Int      @id @default(autoincrement())
  etfId     String
  date      DateTime
  close     Decimal
  interval  String   @default("daily")
  etf       Etf      @relation(fields: [etfId], references: [ticker])

  @@unique([etfId, date, interval])
}

model EtfSector {
  id          Int    @id @default(autoincrement())
  etfId       String
  sector_name String
  weight      Decimal
  etf         Etf    @relation(fields: [etfId], references: [ticker])
}

model EtfAllocation {
  id           Int    @id @default(autoincrement())
  etfId        String @unique
  stocks_weight Decimal
  bonds_weight  Decimal
  cash_weight   Decimal
  etf          Etf    @relation(fields: [etfId], references: [ticker])
}

model PortfolioItem {
  id        Int    @id @default(autoincrement())
  etfId     String @unique
  weight    Decimal
  shares    Decimal  @default(0)
  etf       Etf    @relation(fields: [etfId], references: [ticker])
}
