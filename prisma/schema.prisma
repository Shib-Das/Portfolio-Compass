// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider   = "prisma-client-js"
  previewFeatures = ["driverAdapters"]
}

datasource db {
  provider = "postgresql"
}

model Etf {
  ticker         String          @id
  name           String
  currency       String
  exchange       String?
  price          Decimal
  daily_change   Decimal
  yield          Decimal?
  mer            Decimal?
  beta5Y         Decimal?
  peRatio        Decimal?
  forwardPe      Decimal?
  fiftyTwoWeekHigh Decimal?
  fiftyTwoWeekLow  Decimal?

  // Extended Metrics
  marketCap        Decimal?
  sharesOut        Decimal?
  eps              Decimal?
  revenue          Decimal?
  netIncome        Decimal?
  dividend         Decimal?
  dividendGrowth5Y Decimal?
  exDividendDate   String?
  volume           Decimal?
  open             Decimal?
  prevClose        Decimal?
  earningsDate     String?
  daysRange        String?
  fiftyTwoWeekRange String?

  // New ETF Metrics
  inceptionDate    String?
  payoutFrequency  String?
  payoutRatio      Decimal?
  holdingsCount    Int?
  bondMaturity     Decimal?
  bondDuration     Decimal?

  assetType      String          @default("ETF")
  isDeepAnalysisLoaded Boolean   @default(false)
  history        EtfHistory[]
  sectors        EtfSector[]
  holdings       Holding[]
  allocation     EtfAllocation?
  portfolioItem  PortfolioItem?

  updatedAt      DateTime        @updatedAt
}

model EtfHistory {
  id        Int      @id @default(autoincrement())
  etfId     String
  date      DateTime
  close     Decimal
  interval  String   @default("daily")
  etf       Etf      @relation(fields: [etfId], references: [ticker])

  @@unique([etfId, date, interval])
}

model EtfSector {
  id          Int    @id @default(autoincrement())
  etfId       String
  sector_name String
  weight      Decimal
  etf         Etf    @relation(fields: [etfId], references: [ticker])
}

model Holding {
  id        String   @id @default(cuid())
  etfId     String
  ticker    String
  name      String
  sector    String?
  weight    Decimal
  shares    Decimal?
  etf       Etf    @relation(fields: [etfId], references: [ticker])

  @@index([etfId, ticker])
}

model EtfAllocation {
  id           Int    @id @default(autoincrement())
  etfId        String @unique
  stocks_weight Decimal
  bonds_weight  Decimal
  cash_weight   Decimal
  etf          Etf    @relation(fields: [etfId], references: [ticker])
}

model PortfolioItem {
  id        Int    @id @default(autoincrement())
  etfId     String @unique
  weight    Decimal
  shares    Decimal  @default(0)
  etf       Etf    @relation(fields: [etfId], references: [ticker])
}

model MarketSentiment {
  id     Int      @id @default(autoincrement())
  date   DateTime @unique
  score  Float
  rating String
}
